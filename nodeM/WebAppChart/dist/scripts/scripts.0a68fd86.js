"use strict";var app=angular.module("webApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]);app.factory("AjaxService",["$http",function(a){var b=function(){var b="/proxy";return a.post(b,{urlData:"http://52.88.34.166:9091/history/csv",param:{},method:"GET"})};return{getCSV:function(){return b()}}}]),app.factory("Help",function(){var a=function(a,c){c=c||",";for(var d=new RegExp("(\\"+c+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+c+"\\r\\n]*))","gi"),e=[],f=null;f=d.exec(a);){var g=f[1];if(g.length&&g!=c,f[2])var h=f[2].replace(new RegExp('""',"g"),'"');else var h=f[3];var i=h.split(",");i.length>1&&-1!=b("Rollover",i)&&e.push({openDate:i[6],open:parseFloat(i[1]),closeDate:i[7],close:parseFloat(i[2]),profit:parseInt(i[3]),opType:parseInt(i[4]),cross:i[11],high:parseFloat(i[12]),low:parseFloat(i[13]),magic:parseInt(i[17]),opId:parseFloat(i[18])})}return e},b=function(a,b){for(var c=0,d=0;d<b.length;d++)b[d].match(a)&&(c=-1);return c},c=function(a,b){if(a.length>1){var c,e=[];return a.sort(d(b)).forEach(function(a){a[b[0]]==c?e[e.length-1].push(a):(c=a[b[0]],e.push([a]))}),console.log("arr: ",a),e}return a},d=function(a){var b=Array.prototype.slice.call(a,1);return function(c,e){var f=e[a[0]]-c[a[0]];if(0===f&&a.length>1){var g=d(b)(c,e);return g}return f}};return{csvToArr:function(b,c){return a(b,c)},sort:function(a,b){return c(a,b)}}}),app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/report",{controller:"reportCtrl",templateUrl:"views/report.html"}).otherwise({redirectTo:"/"})}]),angular.module("webApp").controller("MainCtrl",["$scope","$routeParams",function(a,b){a.msg="Welcome to 4Casters WebApp"}]),angular.module("webApp").controller("reportCtrl",["$scope","$routeParams","Help","AjaxService",function(a,b,c,d){a.msg="Algo Report Page",a.arrOpSort="",a.algoId="",a.chart="",a.server="production",a.createCSV=function(){a.arrOpSortForCsv=c.sort(a.arrOp,["magic"]),console.log("$scope.arrOpSortForCsv: ",a.arrOpSortForCsv);var b="data:text/csv;charset=utf-8,";a.arrOpSortForCsv.forEach(function(a,c){a.forEach(function(a,c){var d=Object.keys(a).length,e=0;for(var f in a)d-1>e?b=b+a[f]+",":e==d-1&&(b+=a[f]),e++;b+="\n"})}),console.log("csvContent: ",b);var d=encodeURI(b),e=document.createElement("a");e.className="csv_generator_button",e.textContent="Download CSV",e.setAttribute("href",d),e.setAttribute("download","my_data.csv"),document.getElementById("viewWebApp").appendChild(e)},d.getCSV().success(function(b,d,e){console.log("data: ",b),a.arrOp=c.csvToArr(b.data.data,"â†µ"),a.createCSV(),a.showProfitChart()}).error(function(a,b,c,d){console.log("data error: ",a),console.log("data error: ",b),console.log("data error: ",c)}),a.showProfitChart=function(){a.arrOpSort=c.sort(a.arrOp,["magic"]);var b={},d=[];a.arrOpSort.forEach(function(a,c){b[a[0].magic.toString()]="x"+c,d.push(["x"+c]),d.push([a[0].magic.toString()]),a.forEach(function(a){d[d.length-2].push(a.closeDate),d[d.length-1].push(a.profit)})}),a.chart_title="Profit timeSeries Chart",a.chart=c3.generate({padding:{right:50,left:50,top:10},zoom:{enabled:!0},bindto:"#chart_operations",data:{xFormat:"%m/%d/%Y %H:%M",xs:b,columns:d},axis:{x:{type:"timeseries",tick:{format:"%m/%d/%Y %H:%M",culling:{max:5}}}},color:{pattern:["#6C6767","#B0BDBE","#F5FFFF","#A8A5A5"]}})},a.showComulativeProfitChart=function(){a.arrOpSort=c.sort(a.arrOp,["magic"]);var b={},d=[];a.arrOpSort.forEach(function(a,c){b[a[0].magic.toString()]="x"+c,d.push(["x"+c]),d.push([a[0].magic.toString()]);var e=0;a.forEach(function(a){d[d.length-2].push(a.closeDate),e+=a.profit,d[d.length-1].push(e)})}),a.chart_title="Comulative Profit timeSeries Chart",a.chart=c3.generate({padding:{right:50,left:50,top:10},zoom:{enabled:!0},bindto:"#chart_operations",data:{xFormat:"%m/%d/%Y %H:%M",xs:b,columns:d},axis:{x:{type:"timeseries",tick:{format:"%m/%d/%Y %H:%M",culling:{max:5}}}},color:{pattern:["#6C6767","#B0BDBE","#F5FFFF","#A8A5A5"]}})}}]);